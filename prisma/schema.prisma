generator client {
  provider = "prisma-client-js"
  // output   = "../generated/prisma"
}
datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}
enum Enrollment_type{
  online
  hybrid
}
enum Otp_type{
  none
  registration
  reset_password
  change_password
  forget_password
}
enum OrderStatus {
  pending
  confirmed
  cancelled
  failed
}

enum PaymentStatus {
  PENDING
  SUCCESS
  FAILED
  REFUNDED
  CANCELLED
}

enum PaymentMethod {
  BKASH
  NAGAD
  STRIPE
  SSL_COMMERZ
  CASH
  OTHER
}

model User { 
  id        Int      @id @default(autoincrement())
  user_id String @unique
  name      String   @default(".........")
  phone     String   @unique
  password  String  // hashed
  is_verified Boolean @default(false)
  is_blocked Boolean  @default(false)
  enrollments Enrollment[]
  roles Role[]
  payments Payment[]
  book_orders Book_order[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Course{
  id        Int      @id @default(autoincrement())
  course_id String @unique
  batch String @default("_")
  course_title String
  currilulumns Currilulumn[] 
  slug String @unique
  price Float @default(0)
  thumbnail String @default("localhost://schema.com")
  course_details Course_details?
  createdAt DateTime @default(now())
  enrollments Enrollment[]
  exams Exam[]
  updatedAt DateTime @updatedAt
}
model Course_details{
  id        Int      @id @default(autoincrement())
  course_id String @unique
  slug String @unique
  course_details_id String  @unique
  academy_name String 
  published_date DateTime
  language String
  description String
  // related_book String  @default("") // it will be id
  quiz_count Int @default(0)
  assessment Boolean  @default(false)
  skill_level String
  currilulumns Currilulumn[] 
  expired_date DateTime
  course Course @relation(fields: [course_id],references: [course_id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Currilulumn{
    id        Int      @id @default(autoincrement())
    curriculumn_id String @unique
    course_details_id String
    course_id String 
    title String
    course Course @relation(fields: [course_id],references: [course_id])
    course_details Course_details @relation(fields: [course_details_id], references: [course_details_id])
    topics Currilulumn_topic[]
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Currilulumn_topic{
   id        Int      @id @default(autoincrement())
  currilulumn_topic_id String @unique
  curriculumn_id String
  title String 
  slug String @unique
  youtube_url String
  currilulumn Currilulumn @relation(fields: [curriculumn_id],references: [curriculumn_id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Book{
  id        Int      @id @default(autoincrement())
  book_id String @unique
  slug String @unique
  book_image String
  title String
  price Float
  writter String
  description String
  // course Course_details? @relation(fields: [book_id],references: [related_book])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model Note{ 
  id        Int      @id @default(autoincrement())
  note_id String @unique
  slug String @unique
  note_name String
  note_desc String 
  note_file_link String
  shared_by String // author name
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model Book_order{ 
  id        Int      @id @default(autoincrement())
  order_id String @unique
  product_name String
  user_id String?
  product_price Float
  alternative_phone String
  quantity Int @default(1)
  address String
  Txn_ID String @unique
  status OrderStatus @default(pending)
  confirmed Boolean @default(false)
  payment Payment?
  user          User?    @relation(fields: [user_id], references: [user_id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Enrollment { // ony for course
  id        Int      @id @default(autoincrement())
  enrollment_id String @unique
  enrollment_type Enrollment_type @default(online) // hybrid
  user_id String
  // phone String 
  course_id String
  expiry_date DateTime
  is_expired Boolean @default(false)
  status String // active/inactive/
  enrollment_status String? @default("pending") // failed, success, cancelled etc . (from ssl controllers)
  active_inactive_reason String? // example: due payment
  user User @relation(fields: [user_id],references: [user_id])
  course Course? @relation(fields: [course_id],references: [course_id])
    // Optional Payment relation
  payment Payment?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Exam{
  id        Int      @id @default(autoincrement())
  exam_id String @unique
  course_id String
  exam_title String
  exam_start_time DateTime
  exam_end_time DateTime
  exam_topic String
  exam_description String
  exam_link String
  course Course? @relation(fields: [course_id],references: [course_id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Payment { 
  id              String   @id @default(cuid())
  payment_id String @unique

  // Relation to User
  user_id          String
  user            User     @relation(fields: [user_id], references: [user_id])
  // Payment Details
  meterial_price Float
  discount_amount  Float?         // ছাড়ের পরিমাণ
  amount          Float
  paid_amount     Float
  due_amount      Float
  currency        String   @default("BDT")
  status          PaymentStatus @default(PENDING)
  method          PaymentMethod @default(SSL_COMMERZ)
  Txn_ID   String?  @unique
  paymentGateway  String?  @default("sslcommerz") // e.g. "bkash", "stripe", "sslcommerz", etc.
    // Promo info (optional)
  promo_code_id    String? 
  promo_code      Promo_code?    

  // Metadata
  purpose         String   // e.g. "Course purchase", "Subscription", "Book order"
  book_order_id     String?  @unique //  order_id or enrollment_id etc.
  enrollment_id     String?  @unique //  order_id or enrollment_id etc.
  remarks         String?  // optional note
  course_enrollment Enrollment? @relation(fields: [enrollment_id],references: [enrollment_id])
  book_order Book_order? @relation(fields: [book_order_id],references: [order_id])
  // Timestamps
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}


model Promo_code{
  id        Int      @id @default(autoincrement())
  promo_code_id String @unique
  promocode_for String // book/course
  promo_code String @unique
  Discount_type String // fixed or percentage
  Discount Int //percentage/fixed taka defined from discount type field
  Max_discount_amount Int
  Min_purchase_amount Int
  expiry_date DateTime
  status String
  is_deleted Boolean @default(false)
  payment  Payment?    @relation(fields: [payment_id], references: [payment_id])
  payment_id          String?     @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Otp{
  id        Int      @id @default(autoincrement())
  otp_id String @unique
  otp String // hashed
  otp_type Otp_type @default(none)
  phone String
  expiry_date DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Role {
  id        Int      @id @default(autoincrement())
  role_id String @unique
  user_id String
  phone String
  role String @default("student")
  role_code Int @default(200) // 100 admin, 200 user
  user User @relation(fields: [phone],references: [phone])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}