generator client {
  provider = "prisma-client-js"
  // output   = "../generated/prisma"
}
datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  user_id String @unique
  name      String   @default(".........")
  phone     String   @unique
  password  String  // hashed
  is_verified Boolean @default(false)
  is_blocked Boolean  @default(false)
  orders Order[]
  enrollments Enrollment[]
  roles Role[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Course{
  id        Int      @id @default(autoincrement())
  course_id String @unique
  batch String @default("_")
  course_title String
  currilulumns Currilulumn[] 
  slug String @unique
  Price Int @default(500)
  thumbnail String @default("localhost://schema.com")
  course_details Course_details?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Course_details{
  id        Int      @id @default(autoincrement())
  course_id String @unique
  slug String @unique
  course_details_id String  @unique
  academy_name String 
  published_date DateTime
  language String
  description String
  related_book String // it will be id
  quiz_count Int
  assessment Boolean
  expire String
  skill_level String
  currilulumns Currilulumn[] 
    book               Book         @relation(fields: [related_book], references: [book_id])
  course Course @relation(fields: [course_id],references: [course_id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Currilulumn{
    id        Int      @id @default(autoincrement())
    curriculumn_id String @unique
    course_details_id String
    course_id String 
    title String
    course Course @relation(fields: [course_id],references: [course_id])
    course_details Course_details @relation(fields: [course_details_id], references: [course_details_id])
    topics Currilulumn_topic[]
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt
}

model Currilulumn_topic{
   id        Int      @id @default(autoincrement())
  currilulumn_topic_id String @unique
  curriculumn_id String
  title String 
  slug String @unique
  youtube_url String
  currilulumn Currilulumn @relation(fields: [curriculumn_id],references: [curriculumn_id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Book{
  id        Int      @id @default(autoincrement())
  book_id String @unique
  slug String @unique
  book_image String
  title String
  price Int
  courses   Course_details[] // back relation
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Book_details{
  id        Int      @id @default(autoincrement())
  book_id String @unique
  slug String @unique
  writter String
  description String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  // ref_book_writters  // to be added leter
}

model Note{
  id        Int      @id @default(autoincrement())
  note_id String @unique
  slug String @unique
  note_name String
  note_desc String 
  note_file_link String
  shared_by String // author name
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Order{ // for admin and user: admin can see all details but user will not see just basic data will seee user
// book and course both are in there
  id        Int      @id @default(autoincrement())
  order_id String @unique
  product_name String
  user_id String
  product_price Int
  dicount Int
  promo_code String
  promo_code_id String
  phone String
  orderer_name String
  address String
  status String
  Txn_ID String
  payment_method String
  confirmed Boolean
  user User @relation(fields: [user_id],references: [user_id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Enrollment { // ony for course
  id        Int      @id @default(autoincrement())
  enrollment_id String @unique
  enrollment_type String @default("online") // hybrid
  user_id String
  phone String 
  course_id String
  access_type String // online/hybrid
  expiry_date DateTime
  status String // active/inactive/
  active_inactive_reason String // example: due payment
  user User @relation(fields: [user_id],references: [user_id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Promo_code{
  id        Int      @id @default(autoincrement())
  promo_code_id String @unique
  promocode_for String // book/course
  promo_code String @unique
  Discount_type String // fixed or percentage
  Discount Int //percentage/fixed taka defined from discount type field
  Max_discount_amount Int
  Min_purchase_amount Int
  expiry_date DateTime
  status String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Otp{
  id        Int      @id @default(autoincrement())
  otp_id String @unique
  otp String // hashed
  otp_type String @default("none")// registration, change_pass, 
  phone String
  expiry_date DateTime
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
model Role {
  id        Int      @id @default(autoincrement())
  role_id String @unique
  user_id String
  phone String
  role String @default("student")
  role_code Int @default(200) // 100 admin, 200 user
  user User @relation(fields: [phone],references: [phone])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}